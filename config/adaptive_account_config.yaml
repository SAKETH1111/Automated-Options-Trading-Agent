# 🎯 Adaptive Account Configuration
# Automatically adjusts based on account size and market conditions

trading:
  mode: paper
  market_hours:
    start: "09:30"
    end: "16:00"
    timezone: "America/New_York"
  
  # Dynamic Risk Management (adapts to account size)
  risk:
    # Account-based risk scaling
    account_tiers:
      micro:  # $1,000 - $2,500
        max_risk_per_trade_pct: 12.0  # Higher % for small accounts
        max_positions: 1
        max_daily_loss_pct: 20.0
        position_size_method: "aggressive"
      
      small:  # $2,500 - $5,000
        max_risk_per_trade_pct: 8.0
        max_positions: 2
        max_daily_loss_pct: 15.0
        position_size_method: "balanced"
      
      medium:  # $5,000 - $10,000
        max_risk_per_trade_pct: 5.0
        max_positions: 3
        max_daily_loss_pct: 10.0
        position_size_method: "balanced"
      
      standard:  # $10,000 - $25,000
        max_risk_per_trade_pct: 3.0
        max_positions: 4
        max_daily_loss_pct: 8.0
        position_size_method: "conservative"
      
      large:  # $25,000+
        max_risk_per_trade_pct: 2.0
        max_positions: 5
        max_daily_loss_pct: 5.0
        position_size_method: "conservative"
    
    # Intelligent risk adjustment
    adaptive_risk:
      enabled: true
      
      # Risk based on IV environment
      high_iv_adjustment: 1.2  # Increase risk when IV high (better premium)
      low_iv_adjustment: 0.7   # Decrease risk when IV low (worse premium)
      
      # Risk based on win streak
      after_win_streak_3: 1.1   # Slightly increase after 3 wins
      after_loss_streak_2: 0.6  # Significantly decrease after 2 losses
      
      # Risk based on ML confidence
      high_confidence_adjustment: 1.3  # ML model >80% confident
      low_confidence_adjustment: 0.7   # ML model <60% confident

# Dynamic Symbol Selection (based on account size)
scanning:
  # Adaptive watchlist based on account size
  adaptive_symbols:
    enabled: true
    
    # Micro accounts ($1K-$2.5K) - Ultra-low price symbols
    micro_tier:
      - SQQQ   # ~$9 (inverse QQQ, volatile)
      - UVXY   # ~$10 (volatility ETF)
      - TZA    # ~$15 (inverse IWM)
      max_stock_price: 30
      preferred_spread_width: [1, 2]
    
    # Small accounts ($2.5K-$5K) - Low price symbols
    small_tier:
      - GDX    # ~$28 (gold miners)
      - XLF    # ~$42 (financials)
      - TLT    # ~$95 (bonds)
      - SQQQ   # ~$9 (keep for flexibility)
      max_stock_price: 100
      preferred_spread_width: [2, 3, 5]
    
    # Medium accounts ($5K-$10K) - Medium price + SPY narrow
    medium_tier:
      - XLF    # ~$42
      - TLT    # ~$95
      - IWM    # ~$220 (with narrow spreads)
      - SPY    # ~$550 (narrow spreads only)
      max_stock_price: 250
      preferred_spread_width: [3, 5]
    
    # Standard accounts ($10K-$25K) - SPY/QQQ focus
    standard_tier:
      - SPY    # ~$550
      - QQQ    # ~$480
      - IWM    # ~$220
      max_stock_price: 600
      preferred_spread_width: [5, 10]
    
    # Large accounts ($25K+) - Full flexibility
    large_tier:
      - SPY
      - QQQ
      - IWM
      - DIA
      - XLF
      - XLE
      preferred_spread_width: [5, 10, 15]
  
  # Universal filters
  min_avg_volume: 1000000
  min_open_interest: 100  # Lower for small accounts
  min_volume: 50  # Lower for small accounts
  max_bid_ask_spread_pct: 8.0  # More lenient for smaller stocks

# Adaptive Strategy Selection
strategies:
  # Strategy 1: Adaptive Bull Put Spread
  adaptive_bull_put_spread:
    enabled: true
    
    # DTE Selection (intelligent based on conditions)
    dte_selection:
      mode: "intelligent"  # Options: intelligent, fixed, weekly_only, monthly_only
      
      # Intelligent rules
      use_weekly_when:
        - iv_rank_above: 40  # High IV = sell weekly for faster decay
        - win_streak_above: 2  # On a roll = weekly for more trades
        - ml_confidence_above: 0.75  # Very confident = weekly
        - account_tier: ["micro", "small"]  # Small accounts need faster income
      
      use_monthly_when:
        - iv_rank_below: 40  # Low IV = monthly for better credit
        - loss_streak_above: 1  # After loss = slower/safer
        - ml_confidence_below: 0.65  # Less confident = more time
        - account_tier: ["standard", "large"]  # Larger accounts = patience
      
      # Default ranges
      weekly_dte_range: [7, 14]
      monthly_dte_range: [30, 45]
      quarterly_dte_range: [60, 90]
    
    # Delta based on account size
    delta_selection:
      micro_accounts: [-0.30, -0.20]  # Higher delta = more premium
      small_accounts: [-0.28, -0.22]
      medium_accounts: [-0.25, -0.20]
      standard_accounts: [-0.25, -0.18]  # More conservative
      large_accounts: [-0.20, -0.15]  # Very conservative
    
    # Width based on account tier
    width_selection:
      auto_select: true
      
      # Risk-based width selection
      selection_logic:
        - if: account_tier == "micro"
          then: width = [1, 2]
        - if: account_tier == "small"
          then: width = [2, 3, 5]
        - if: account_tier in ["medium", "standard"]
          then: width = [3, 5, 10]
        - if: account_tier == "large"
          then: width = [5, 10, 15]
    
    # Credit requirements (scaled)
    credit_requirements:
      micro_accounts:
        min_credit: 0.15
        min_premium_dollars: 15
      small_accounts:
        min_credit: 0.25
        min_premium_dollars: 25
      medium_accounts:
        min_credit: 0.35
        min_premium_dollars: 35
      standard_accounts:
        min_credit: 0.40
        min_premium_dollars: 40
      large_accounts:
        min_credit: 0.50
        min_premium_dollars: 50
    
    # Exit rules (adaptive)
    exit_rules:
      # Conservative for small accounts
      micro_small_accounts:
        take_profit_pct: 40  # Take profits faster
        stop_loss_pct: 75   # Tighter stops
      
      # Standard for larger accounts
      medium_large_accounts:
        take_profit_pct: 50
        stop_loss_pct: 100

  # Strategy 2: Adaptive Iron Condor (medium+ accounts)
  adaptive_iron_condor:
    enabled: true
    min_account_tier: "medium"  # Only for $5K+ accounts
    
    dte_selection:
      mode: "intelligent"
      prefer_monthly: true  # ICs work better with more time
    
    symbols: ["SPY", "IWM"]  # Range-bound indices
    short_put_delta_range: [-0.18, -0.15]
    short_call_delta_range: [0.15, 0.18]
    width: "auto"  # Based on account tier
    min_credit: 0.60
    take_profit_pct: 50
    stop_loss_pct: 100

# Intelligent Decision Engine
intelligence:
  # ML-Enhanced Decision Making
  ml_integration:
    enabled: true
    
    # Use multi-timeframe ensemble
    use_ensemble_predictions: true
    
    # Confidence thresholds
    min_confidence_to_trade:
      micro_accounts: 0.55  # Can trade with lower confidence (need volume)
      small_accounts: 0.60
      medium_accounts: 0.65
      standard_accounts: 0.70
      large_accounts: 0.75  # Very selective
    
    # Timeframe selection based on position duration
    timeframe_selection:
      weekly_options:
        primary: "5min_intraday"
        secondary: ["1min_scalping", "15min_swing"]
        use_case: "Quick in-and-out, high IV"
      
      monthly_options:
        primary: "1day_swing"
        secondary: ["1hour_position", "1week_swing"]
        use_case: "Standard theta decay, moderate IV"
      
      quarterly_options:
        primary: "1month_position"
        secondary: ["1week_swing", "3month_investment"]
        use_case: "Long-term bullish, low IV"
  
  # Risk/Reward Optimization
  risk_reward_selection:
    # More aggressive for small accounts (need growth)
    micro_accounts:
      prefer_strategy: "weekly_high_delta"  # More premium
      max_risk_reward: 5.0  # Can accept higher R:R
      min_probability: 65  # Can accept lower probability
    
    # Balanced for medium accounts
    medium_accounts:
      prefer_strategy: "balanced_monthly"
      max_risk_reward: 3.5
      min_probability: 70
    
    # Conservative for large accounts (preserve capital)
    large_accounts:
      prefer_strategy: "conservative_monthly"
      max_risk_reward: 2.5
      min_probability: 75

# IV-Based Strategy Selection
iv_based_selection:
  enabled: true
  
  # High IV Environment (IV Rank > 50)
  high_iv_strategy:
    prefer: "weekly_options"  # Sell premium aggressively
    dte: [7, 14]
    increase_risk_by: 20%  # More premium available
    delta_target: [-0.30, -0.20]  # Higher delta for more credit
  
  # Medium IV Environment (IV Rank 30-50)
  medium_iv_strategy:
    prefer: "bi_weekly_options"
    dte: [14, 30]
    maintain_risk: true
    delta_target: [-0.25, -0.20]
  
  # Low IV Environment (IV Rank < 30)
  low_iv_strategy:
    prefer: "monthly_options"  # Need more time for theta
    dte: [30, 45]
    decrease_risk_by: 20%  # Less premium, be more selective
    delta_target: [-0.20, -0.15]  # More conservative

# Win/Loss Streak Adaptation
streak_adaptation:
  enabled: true
  
  # After winning streak
  win_streak_rules:
    3_wins:
      action: "maintain_course"
      risk_adjustment: 1.0
    
    5_wins:
      action: "slightly_increase"
      risk_adjustment: 1.1
      confidence_threshold: 0.70  # Stay selective
    
    10_wins:
      action: "maintain_discipline"
      risk_adjustment: 1.0  # Don't get overconfident!
      reminder: "Great job! Stay disciplined."
  
  # After losing streak
  loss_streak_rules:
    1_loss:
      action: "review_and_continue"
      risk_adjustment: 0.9
    
    2_losses:
      action: "reduce_risk"
      risk_adjustment: 0.6
      increase_confidence_threshold: 0.75
    
    3_losses:
      action: "pause_and_analyze"
      risk_adjustment: 0.0  # Stop trading
      require_manual_resume: true
      notification: "3 losses in a row - system paused for review"

# Market Regime Adaptation
market_regime_rules:
  enabled: true
  
  # Bull Market (trending up, low VIX)
  bull_regime:
    detection:
      - sma_50_above_sma_200: true
      - vix_below: 18
      - spy_trend: "up"
    
    strategy_adjustments:
      prefer: "bull_put_spreads"
      dte: [30, 45]  # Monthly - ride the trend
      risk_adjustment: 1.2  # Can be more aggressive
      delta: [-0.25, -0.20]
  
  # Bear Market (trending down, elevated VIX)
  bear_regime:
    detection:
      - sma_50_below_sma_200: true
      - vix_above: 25
      - spy_trend: "down"
    
    strategy_adjustments:
      prefer: "bear_call_spreads"  # Or stay cash
      dte: [14, 21]  # Shorter duration
      risk_adjustment: 0.6  # Very conservative
      delta: [0.15, 0.20]
      max_positions: 1  # Limit exposure
  
  # Choppy/Sideways (range-bound, moderate VIX)
  choppy_regime:
    detection:
      - vix_between: [15, 25]
      - spy_trend: "sideways"
      - adr_low: true
    
    strategy_adjustments:
      prefer: "iron_condors"  # Perfect for ranges
      dte: [30, 45]
      risk_adjustment: 1.0
      delta_puts: [-0.18, -0.15]
      delta_calls: [0.15, 0.18]

# Symbol Selection Logic
symbol_selection:
  mode: "account_adaptive"
  
  # Rules for symbol selection
  selection_algorithm:
    step_1: "Determine account tier"
    step_2: "Get available symbols for tier"
    step_3: "Filter by current IV environment"
    step_4: "Score symbols by opportunity"
    step_5: "Select top 2-3 symbols"
  
  # Scoring factors
  scoring:
    liquidity_weight: 30  # High importance
    iv_rank_weight: 25    # Want elevated IV
    ml_confidence_weight: 25  # ML prediction strength
    spread_quality_weight: 10  # Bid-ask spread
    trend_alignment_weight: 10  # Trend with our bias

# DTE Selection Logic (Intelligent)
dte_selection:
  mode: "adaptive"
  
  # Decision tree for DTE selection
  decision_rules:
    # Rule 1: Account size influence
    - if: account_size < 2500
      then:
        prefer: "weekly"
        reason: "Small accounts need faster income turnover"
        dte: [7, 14]
    
    - if: account_size >= 2500 and account_size < 10000
      then:
        prefer: "flexible"
        reason: "Balance between income and safety"
        dte: [14, 30]
    
    - if: account_size >= 10000
      then:
        prefer: "monthly"
        reason: "Larger accounts can afford patience"
        dte: [30, 45]
    
    # Rule 2: IV Environment override
    - if: iv_rank > 50 and account_size < 5000
      then:
        override: "weekly"
        reason: "High IV + small account = sell aggressively"
        dte: [7, 14]
    
    - if: iv_rank < 30
      then:
        override: "monthly_or_skip"
        reason: "Low IV = need more time or wait"
        dte: [30, 45]
    
    # Rule 3: ML Confidence influence
    - if: ml_ensemble_confidence > 0.80
      then:
        allow: "weekly"
        reason: "Very confident = can use shorter DTE"
    
    - if: ml_ensemble_confidence < 0.60
      then:
        require: "monthly"
        reason: "Less confident = need more time to be right"
    
    # Rule 4: Volatility forecast
    - if: ml_volatility_forecast == "increasing"
      then:
        prefer: "weekly"
        reason: "Volatility rising = close before it spikes"
    
    - if: ml_volatility_forecast == "stable"
      then:
        prefer: "monthly"
        reason: "Stable vol = can hold longer"

# Risk Tolerance Selection (Intelligent)
risk_tolerance:
  mode: "adaptive"
  
  # Base risk by account tier (can be overridden)
  base_risk_by_tier:
    micro: 12.0    # Aggressive (need growth)
    small: 8.0     # Balanced-Aggressive
    medium: 5.0    # Balanced
    standard: 3.0  # Balanced-Conservative
    large: 2.0     # Conservative (preserve capital)
  
  # Adaptive adjustments
  adjust_based_on:
    # 1. Recent performance
    recent_win_rate:
      - if: win_rate > 75% (last 10 trades)
        then: increase_risk_by: 10%
      - if: win_rate < 60% (last 10 trades)
        then: decrease_risk_by: 30%
    
    # 2. Drawdown level
    current_drawdown:
      - if: drawdown < 5%
        then: maintain_risk
      - if: drawdown > 10%
        then: reduce_risk_by: 50%
      - if: drawdown > 15%
        then: pause_trading
    
    # 3. Market volatility
    vix_level:
      - if: vix < 15
        then: reduce_risk_by: 20%  # Low premium environment
      - if: vix > 25
        then: reduce_risk_by: 20%  # High risk environment
      - if: vix between [18, 25]
        then: maintain_risk  # Sweet spot
    
    # 4. Time in market
    experience_level:
      - if: total_trades < 20
        then: use_conservative_risk
      - if: total_trades > 50 and win_rate > 70%
        then: allow_increased_risk

# Position Management
position_management:
  # Max positions by account size
  max_concurrent_positions:
    auto_calculate: true
    formula: "min(floor(account_balance / 2500), max_by_tier)"
    
    by_tier:
      micro: 1
      small: 2
      medium: 3
      standard: 4
      large: 6
  
  # Portfolio heat (total capital at risk)
  max_portfolio_heat:
    micro: 35%    # Can have 35% at risk (aggressive)
    small: 30%
    medium: 25%
    standard: 20%
    large: 15%    # Conservative

# Example Trades by Account Size
example_trades:
  "$1,500_account":
    tier: "micro"
    symbol: "SQQQ"
    strategy: "Bull Put Spread (Weekly)"
    setup: "Sell $8.50 put, Buy $7.50 put"
    width: "$1 ($100 risk)"
    credit: "$0.20 ($20)"
    risk_pct: "10% of account ($150 risk budget)"
    dte: "7-14 days (weekly)"
    ml_timeframe: "5min_intraday"
    reason: "Small account needs fast turnover + high delta for premium"
  
  "$3,500_account":
    tier: "small"
    symbol: "XLF"
    strategy: "Bull Put Spread (Bi-weekly)"
    setup: "Sell $40 put, Buy $38 put"
    width: "$2 ($200 risk)"
    credit: "$0.50 ($50)"
    risk_pct: "8% of account ($280 risk budget)"
    dte: "14-21 days"
    ml_timeframe: "15min_swing + 1day_swing ensemble"
    reason: "Balanced growth + decent premium"
  
  "$7,500_account":
    tier: "medium"
    symbol: "SPY"
    strategy: "Bull Put Spread (Monthly)"
    setup: "Sell $540 put, Buy $535 put"
    width: "$5 ($500 risk)"
    credit: "$1.25 ($125)"
    risk_pct: "5% of account ($375 risk budget)"
    dte: "30-45 days (monthly)"
    ml_timeframe: "1day_swing + 1week_swing ensemble"
    reason: "Can afford standard SPY setup with narrow spreads"
  
  "$15,000_account":
    tier: "standard"
    symbol: "SPY"
    strategy: "Bull Put Spread (Monthly)"
    setup: "Sell $540 put, Buy $530 put"
    width: "$10 ($1,000 risk)"
    credit: "$2.50 ($250)"
    risk_pct: "3% of account ($450 risk budget)"
    dte: "30-45 days"
    ml_timeframe: "1day_swing + 1week_swing + 1month_position ensemble"
    reason: "Standard setup, can be patient and selective"

# Learning System
learning:
  enabled: true
  
  # Account-specific learning goals
  learning_goals_by_tier:
    micro:
      target_win_rate: 65%  # Realistic for aggressive small account
      target_profit_factor: 1.5
      monthly_return_target: 8-12%  # Aggressive growth
    
    small:
      target_win_rate: 68%
      target_profit_factor: 1.8
      monthly_return_target: 5-8%
    
    medium:
      target_win_rate: 70%
      target_profit_factor: 2.0
      monthly_return_target: 3-6%
    
    standard:
      target_win_rate: 72%
      target_profit_factor: 2.2
      monthly_return_target: 2-4%
    
    large:
      target_win_rate: 75%
      target_profit_factor: 2.5
      monthly_return_target: 1.5-3%  # Preserve capital focus

# Monitoring
monitoring:
  account_tier_updates:
    check_frequency: "daily"
    auto_upgrade_tier: true  # Automatically move to next tier as account grows
    
    # Example: Start with $2K, grow to $5.5K → Auto upgrade from micro to medium
    
  notifications:
    tier_upgrade:
      enabled: true
      message: "🎉 Account upgraded to {new_tier}! New limits: {new_limits}"
    
    risk_adjustment:
      enabled: true
      message: "⚠️ Risk adjusted to {new_risk_pct}% based on {reason}"
